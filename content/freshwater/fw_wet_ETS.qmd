---
# indentations are critical in YAML headers, be careful when editing this section

title: "Wetland Ecosystem Threat Status" # Compulsory
subtitle: "Freshwater (inland aquatic) realm" # Optional: delete if you are not using a subtitle

title-block-banner: "#4097C2" #Background colour of the title block: Apply component colours where necessary - find hex codes in _brand.yml
title-block-banner-color: white # Header text colour: DO NOT CHANGE

# List authors here in the order you want them displayed in the title block
# See examples in README
author:
  # Copy this block and add details for each author of your page. Make sure you maintain indentations exactly as they are here
  - name:
      given: Nancy 
      family: Job 
    orcid: 0000-0002-4929-7592 
    affiliations:
      - ref: sanbi
      # If an author has more than one affiliation, add more - ref: lines here
  - name:
      given: Andrew 
      family: Skowno
    affiliations:
      - ref: sanbi 
  - name:
      given: Jock 
      family: Currie 
    orcid: 0000-0002-0000-0000 
    affiliations:
      - ref: other 
  - name:
      given: Nacelle  
      family: Collins 
    orcid: 0000-0000-0000-0000 
    affiliations:
      - ref: destea
      # If an author has more than one affiliation, add more - ref: lines here
  - name:
      given: Adwoa  
      family: Awuah 
    orcid: 0000-0000-0000-0000 
    affiliations:
      - ref: sanbi
      # If an author has more than one affiliation, add more - ref: lines here
      
affiliations:
# List affiliations here and number them in the order that they are associated with the list of authors above. If multiple authors have the same affiliation, only list the affiliation once here.
# Write out institutional names in full
# See README for common examples - they can be copied and pasted here
# Make sure you maintain indentations exactly as they are here
  - id: sanbi 
    number: 1 
    name: South African National Biodiversity Institute
  - id: destea 
    number: 2 
    name: Free State Department of Economic, Small Business Development, Tourism and Environmental Affairs
  - id: other 
    number: 3 
    name: South African National Biodiversity Institute

# This date determines the PUBLISHED date in the title block
date: last-modified

# Remember to rename the default .bib file and change the name here
bibliography: fw-references.bib

# This section sets up the page citation format. DO NOT EDIT
citation:
  type: webpage
  container-title: National Biodiversity Assessment 2025
  publisher: South African National Biodiversity Institute
  url: http://nba.sanbi.org.za/
# Do not edit or change any of the following entries
appendix-cite-as: false
google-scholar: true
---

**Inland wetlands remain highly threatened and under-protected. This places the vital services they provide and the incredible biodiversity they support at great risk.**

<!-- need to find the inline style for "critically endangered" -->

::::: columns
::: {.column width="50%"}
<center>

| [20%]{.inline-style-threatened}
| of wetland extent
| [Critically Endangered]{.inline-style-indicator}

</center>
:::

::: {.column width="50%"}
<center>

| [85%]{.inline-style-threatened}
| of wetland extent
| [Threatened]{.inline-style-indicator}

</center>
:::
:::::

:::: columns
::: {.column width="50%"}
:::
::::

Add text here

![Ecosystem threat status for inland wetland ecosystem types. The inset doughnut shows the number of ecosystem types per threat category.](imgs/wet_ets_map.png){#fig-ets_wet_map}

Approximately 65% of inland wetland extent and 72% of inland wetland ecosystem types are threatened. In terms of threatened inland wetland ecosystem types, approximately 18% are Critically Endangered, 24% Endangered and 30% are Vulnerable. In terms of wetland extent, approximately 20% is Critically Endangered, 21% Endangered and 45% is Vulnerable.

<!-- jock is it possible for the text in the heading and the body of the table to both be one size smaller, across all of the freshwater webpages? For this table, instead of "zone" please replace with "HGM type" -->

```{r}
#| label: tbl-ets
#| tbl-cap: "Ecosystem Threat Status of inland wetland ecosystem types."

# library(here)
library(stringr)
library(reactable)
library(dplyr)

# load data
ets <- read.csv(file=list.files(path = "data", pattern = "^wet_metrics_type.csv$", recursive = TRUE, full.names = TRUE), 
                    stringsAsFactors = FALSE, check.names = FALSE) %>% 
  select(type, zone, RLE24) %>% # , RLE24, extent, RLE_RLE24) #
    mutate(RLE24 = str_replace_all(RLE24, "CR","Critically Endangered" ),
         RLE24 = str_replace_all(RLE24, "EN","Endangered" ),
         RLE24 = str_replace_all(RLE24, "VU","Vulnerable" ),
         RLE24 = str_replace_all(RLE24, "NT","Near Threatened" ), 
         RLE24 = str_replace_all(RLE24, "LC","Least Concern" )) %>% 
  rename("Wetland type" = type,
         Zone = zone,
         "Ecosystem Threat Status" = RLE24)

# create the table
reactable(
  ets,
  filterable = TRUE,
  searchable = FALSE,
  pagination = FALSE,
  height = 600,
  defaultColDef = colDef(
    headerStyle = list(background = "#4097C2", color = "white", fontWeight = "bold")
  ),
  theme = reactableTheme(
    inputStyle = list(
      color = "black", # create black searching text in the filter box, otherwise one doesn't see it!
      backgroundColor = "white",
      border = "1px solid #ccc"
    )))

```

Add text

<!-- jock is it possible for the table / ie the coloured threat status part to be less compressed and to stretch across the page more? "unchannelled valley-bottom" could be two lines if this is what is causing the table to squash? -->

:::: panel-tabset
## Figure

<!-- it is important to use second-level headings in panel tabsets, i.e. two hashes -->

```{r}
#| label: fig-wetland_ets_bargraph
#| fig-cap: "Inland Wetland Ecosystem Threat Status shown for each hydrogeomorphological (HGM) category and (a) percentage of ecosystem types (labelled with their counts) in each protection level category; (b) percentage wetland extent (km^2^) in each protection level category." 

library(tidyverse)
library(stringr)
library(nbaR)

# load and prep the data
ets <- read.csv(file=list.files(path = "./data", pattern = "^wet_metrics_type.csv$", recursive = TRUE, full.names = TRUE), 
                stringsAsFactors = FALSE, check.names = FALSE) %>% 
  select(type, zone, RLE24, extent) %>% # , RLE24, extent, RLE_RLE24) #
      mutate(RLE24 = str_replace_all(RLE24, "CR","Critically Endangered" ),
         RLE24 = str_replace_all(RLE24, "EN","Endangered" ),
         RLE24 = str_replace_all(RLE24, "VU","Vulnerable" ),
         RLE24 = str_replace_all(RLE24, "NT","Near Threatened" ), 
         RLE24 = str_replace_all(RLE24, "LC","Least Concern" )) %>% 
  group_by(zone, RLE24) %>%
  summarise(count = n(),
            extent = sum(extent))
  # rename("Wetland type" = type,
  #        Zone = zone,
  #        "Ecosystem Threat Status" = RLE24)

# count table
count <- ets %>%
  pivot_wider(
    id_cols = zone,
    names_from = RLE24,
    values_from = count) %>%
  mutate(across(where(is.numeric), ~replace_na(.x,0))) %>% 
  ungroup() %>% 
  select(zone, 'Critically Endangered', 'Endangered', 'Vulnerable', 'Least Concern') %>% # reorder the columns
  rowwise() %>% 
  mutate(Total = sum(as.numeric(c_across(!contains("zone"))), na.rm = TRUE)) %>% 
  ungroup()
# count

## add a totals row:
count <- count %>%
  bind_rows(
    count %>%
      summarise(across(where(is.numeric), ~ sum(.x, na.rm = TRUE))) %>%
      mutate(zone = "Total count") %>%
      select(zone, everything())
  )
# count

# extent table
extent <- ets %>%
  pivot_wider(
    id_cols = zone,
    names_from = RLE24,
    values_from = extent) %>%
  mutate(across(where(is.numeric), ~replace_na(.x,0))) %>% 
  ungroup() %>% 
select(zone, 'Critically Endangered', 'Endangered', 'Vulnerable', 'Least Concern') %>% # reorder the columns
  rowwise() %>% 
  mutate(Total = sum(as.numeric(c_across(!contains("zone"))), na.rm = TRUE)) %>% 
  ungroup()
# extent

# add a totals row:
extent <- extent %>%
  bind_rows(
    extent %>%
      summarise(across(where(is.numeric), ~ sum(.x, na.rm = TRUE))) %>%
      mutate(zone = "Total extent") %>%
      select(zone, everything())
  )
# extent

# combine count and extent in a single table
ets_combined <- count %>%
  mutate(metric = "count") %>%
  bind_rows(extent %>%
              mutate(metric = "extent")) %>%
  mutate(zone = factor(zone, levels = c("Depression", "Floodplain", "Seep", "Unchannelled valley-bottom", "Total count", "Total extent")))
# ets_combined
    
## save the data to downloadable csv for the link, before arranging by zone for the plot
write.csv(ets_combined, file = "./outputs/wetlands_ETS.csv", row.names = FALSE)

# create ets plot
ets_combined_plot <- ets_combined %>% 
    arrange(desc(zone)) %>% 
    nba_plot_comb(
      zone,
                                   METRIC_COL = metric,
                                   METRICS = c("count", "extent"),
                                   2:5,
                                   CHRT = "bar",
                                   NUM = FALSE,
                                   LAB = "Percentage of ecosystem",
                                   SAVE = NULL) 

ets_combined_plot

```

## Data

::: {#table .table style="height:500px;overflow-y: auto"}
```{r}
#| label: tbl-river_ets
#| tbl-cap: "Table of inland Wetland protection level data." 
#| classes: plain

library(dplyr)
library(nbaR)
library(gt)

## create the table
# as we prepared the data above for the combined plot, simply provide those? checkNancy
tbl_dat <- ets_combined %>% 
  arrange(metric,zone) %>% 
  rename(Zone = zone,
         Metric = metric)

gt(tbl_dat) %>% nba_tbl_theme()

```
:::

Download the data [here](outputs/wetlands_ETS.csv).
::::

\[Photo\]

## Approach

Ecosystem Threat Status is a headline indicator established for assessing how close ecosystem types are to collapsing or losing vital aspects of their structure, function, or composition.

Each of the 82 inland wetland ecosystem types were placed into one of four categories: Critically Endangered (CR), Endangered (EN), Vulnerable (VU) and Least Concern (LC); where CR, EN and VU together make up the threatened categories. The categories are based on assessments of quantitative and qualitative criteria (and thresholds) linked to ecosystem extent, ecological condition and threatening processes. Read more here: chl_rle_explained.qmd // \[For consistency with NBA 2018, the NBA 2025 ETS assessment follows the methods developed by Nel et al. (2007) and modified by van Deventer et al. (2019).\] The approach uses the proportion of each ecosystem type that is in a good to fair condition (PES class A B and C) and a set of thresholds. If less than 20% of a type (measured by length of river segment) is in a A or B condition then the type is categorised as Critically Endangered; if between 20-35% of the type is in A or B condition then the type is categorised as Endangered; if less than 60% of the type is in A or or C condition then the type is categorised as Vulnerable; if none of these thresholds are crossed then the type is Least Concern. This method aligns with the South African Framework for Threatened ecosystems but not the IUCN RLE 1.1. Processes to transition to the IUCN framework are underway - but in the interest of comparing past results, the 2011 methods have been implemented.

## Technical documentation

-   **Code repository**: https://github.com/askowno/RLE_wetl

-   **Data repository**: [OPUS](https://opus.sanbi.org/home), [Figshare](https://figshare.com/), [KNB](https://knb.ecoinformatics.org/) or [BGIS](https://bgis.sanbi.org/) - link to the specific page within these websites containing your data.

-   **Key publications:**

xx

## References

::: {#refs}
1.  xx
:::

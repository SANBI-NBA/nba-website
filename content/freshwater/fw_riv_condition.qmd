---
# indentations are critical in YAML headers, be careful when editing this section

title: "River ecological condition" # Compulsory
subtitle: "Freshwater (inland aquatic) realm" # Optional: delete if you are not using a subtitle

title-block-banner: "#4097C2" #Background colour of the title block: Apply component colours where necessary - find hex codes in _brand.yml
title-block-banner-color: white # Header text colour: DO NOT CHANGE

# List authors here in the order you want them displayed in the title block
# See examples in README
author:
  # Copy this block and add details for each author of your page. Make sure you maintain indentations exactly as they are here
  - name:
      given: Nancy 
      family: Job 
    orcid: 0000-0002-4929-7592 
    affiliations:
      - ref: sanbi
      # If an author has more than one affiliation, add more - ref: lines here
  - name:
      given: Michael 
      family: Silberbauer
    affiliations:
      - ref: independent 
 
affiliations:
# List affiliations here and number them in the order that they are associated with the list of authors above. If multiple authors have the same affiliation, only list the affiliation once here.
# Write out institutional names in full
# See README for common examples - they can be copied and pasted here
# Make sure you maintain indentations exactly as they are here
  - id: sanbi 
    number: 1 
    name: South African National Biodiversity Institute
  - id: independent 
    number: 2 
    name: Independent


# This date determines the PUBLISHED date in the title block
date: last-modified

# Remember to rename the default .bib file and change the name here
bibliography: fw-references.bib

# This section sets up the page citation format. DO NOT EDIT
citation:
  type: webpage
  container-title: National Biodiversity Assessment 2025
  publisher: South African National Biodiversity Institute
  url: http://nba.sanbi.org.za/
# Do not edit or change any of the following entries
appendix-cite-as: false
google-scholar: true
---

*Rivers are among the most threatened ecosystems in South Africa, with over 60% of their extent in a compromised state. This has placed the vital services they provide and the incredible biodiversity they support at great risk.*

![Surveying a river for freshwater fishes. (© Jeremy Shelton)](imgs/jeremy_12.png)

------------------------------------------------------------------------

::::: columns
::: {.column width="50%"}
<center>

| [25%]{.inline-style-well-protected}
| of river length
| Natural or Near-natural

</center>
:::

::: {.column width="50%"}
<center>

| [26%]{.inline-style-not-protected}
| of 222 river ecosystem types
| Natural or Near-natural

</center>
:::
:::::

:::: columns
::: {.column width="50%"}
:::
::::

------------------------------------------------------------------------

:::: panel-tabset
## Map

![Ecological condition for river ecosystem types. The inset graph shows percentage of river length within each condition category.](imgs/riv_condition_map.png){#fig-condition_wet_map}

<!-- Update Figure 1 inset graph to be percent of river length -->

## Data

::: {.table style="height:500px;overflow-y: auto"}
<!-- ::: {#box-eco_tbl .callout .freshwater collapse="False"} -->

```{r}
#| label: tbl-wetland_condition_bytype
#| tbl-cap: Ecological condition of river ecosystem types summarised by river type. Note that extent figures represent river length (km) and have been rounded.
#| classes: plain

library(dplyr)
# library(tidyverse)
library(stringr)
library(nbaR)
library(gt) # library(reactable)

## load data
condition_tbl <- read.csv(file=list.files(pattern = "^rivers_condition_combined_extent_percent_by_type.csv$", recursive = TRUE, full.names = TRUE), stringsAsFactors = FALSE, check.names = FALSE) #

## create the table
tbl <- condition_tbl %>% 
  mutate(metric = str_replace_all(metric, "extent", "Extent  (km)"),
         metric = str_replace_all(metric, "percent", "Percentage")) %>% 
  arrange(type) %>% 
  select(type, metric, 'Natural', 'Near-natural', 'Moderately modified', 'Heavily modified', 'Severely modified', 'Critically modified') %>%
  mutate(across(where(is.numeric), round)) %>% 
  gt::gt(
    rowname_col = "metric",
    groupname_col = "type",
    row_group_as_column = TRUE) %>% 
  fmt_number(
    columns = where(is.numeric),
    decimals = 0,
    sep_mark = "\u202F") %>% 
  fmt_markdown(columns = metric) %>%  # tells gt to render HTML/Markdown in that column
  nbaR::nba_tbl_theme(HEADER = "Freshwater") %>% 
  tab_style(
    style = cell_text(color = "white"),
    locations = cells_column_labels()
  )

tbl


```
:::

Download the data by river type [here](data/rivers_condition_combined_extent_percent_by_type.csv).
::::

Only a quarter of the total length of river ecosystems in South Africa are in a natural/near-natural ecological condition, with three-quarters in a moderately modified or worse condition. Approximately 42% of mountain streams extent is in a natural or near-natural condition, in contrast with lowland rivers which have only 15% in a natural or near-natural condition. The extent of ecosystem modifications in lowland rivers reflects the geographic differences wide array of pressures that are concentrated in rivers that negatively impact on ecosystems and species.

:::: panel-tabset
## Figure

<!-- it is important to use second-level headings in panel tabsets, i.e. two hashes -->

```{r}
#| label: fig-river_condition_bargraph
#| fig-cap: "River ecological condition within each geomorphological zone (slope category). (a) The percentage of ecosystem types per category (labelled with the number per type); (b) the percentage of river length (km) within each threat category, providing an indication of the relative extent of each category."

library(tidyverse)
library(stringr)
library(nbaR)

## load data
condition_tbl <- read.csv(file=list.files(pattern = "^rivers_condition_combined_extent_percent.csv$", recursive = TRUE, full.names = TRUE), stringsAsFactors = FALSE, check.names = FALSE) %>%
  mutate(zone = factor(zone, levels = c("Mountain stream", "Upper foothill", "Lower foothill", "Lowland river"))) # first depression then seep then unchannelled valley-bottom, then floodplain last , "Total count", "Total extent"

condition_tbl %>% 
  filter(metric == "percent") %>% 
  arrange(desc(zone)) %>% 
  # # rename the two columns we're going to sum so that they can be excluded after summing
  # # rename(severe = `Severely modified`,
  # #        critical = `Critically modified`) %>% 
  # mutate(`Severely modified` = `Severely modified` + `Critically modified`,
  #        `Critically modified` = 0) %>%
  select(zone, Natural, `Near-natural`, `Moderately modified`, `Heavily modified`, `Severely modified`, `Critically modified`) %>% # 
  # round the percentages
  mutate(across(where(is.numeric), ~ round(., digits=0))) %>% 
  nba_plot(
    GROUPS=zone,
    COLS=Natural:`Critically modified`,
    CHRT = "bar",
    NUM = TRUE,
    LAB = "Percentage of ecosystem extent",
    SAVE = NULL) +
  theme(plot.margin=grid::unit(c(0,43,0,0), "pt")) # need large righ margin to avoid cutting off the legend text; could be reduced if we merge groups? top, right, bottom, and left margins

```

## Data

::: {#table .table style="height:500px;overflow-y: auto"}
```{r}
#| label: tbl-river_condition
#| tbl-cap: Ecological condition of river ecosystem types summarised by geomorphological zone. Note that extent figures represent river length (km) and have been rounded.
#| classes: plain

library(dplyr)
library(nbaR)
library(gt)

## create the table

tbl <- condition_tbl %>% 
  mutate(metric = str_replace_all(metric, "extent", "Extent  (km)"),
         metric = str_replace_all(metric, "percent", "Percentage")) %>% 
  arrange(zone) %>% 
  select(zone, metric, 'Natural', 'Near-natural', 'Moderately modified', 'Heavily modified', 'Severely modified', 'Critically modified') %>%
  mutate(across(where(is.numeric), round)) %>% 
  gt::gt(
    rowname_col = "metric",
    groupname_col = "zone",
    row_group_as_column = TRUE) %>% 
  fmt_number(
    columns = where(is.numeric),
    decimals = 0,
    sep_mark = "\u202F") %>% 
  fmt_markdown(columns = metric) %>%  # tells gt to render HTML/Markdown in that column
  nbaR::nba_tbl_theme(HEADER = "Freshwater") %>% 
  tab_style(
    style = cell_text(color = "white"),
    locations = cells_column_labels()
  )

tbl

```
:::

Download the data [here](data/rivers_condition_combined_extent_percent.csv).
::::

## Approach

River ecological condition was assessed as part of the [Present Ecological State (PES) and Ecological Importance and Sensitivity](https://www.dws.gov.za/iwqs/rhp/eco/peseismodel.aspx) national project currently underway by the Department of Water and Sanitation (DWS) and the Water Research Commission of South Africa (WRC), along with appointed specialists. The process was expert driven, where rivers were reviewed at quinary catchment level according to a standardised methodology to describe the extent of ecosystem modification by assessing six indicators, namely flow modification, physico-chemical modification, in-stream habitat and habitat continuity modification, riparian/wetland zone habitat and habitat continuity modification. Information from the six indicator assessments was aggregated into a final condition score, assigning ecological condition categories ranging from natural (A) to critically modified or extremely degraded (F). The score was per quinary reach in the original dataset and was cross-walked to the river ecosystem type units for the NBA assessment.

## Technical documentation

**Related publications and supporting information**

Department of Water and Sanitation. 2014. A Desktop Assessment of the Present Ecological State, Ecological Importance and Ecological Sensitivity per Sub Quaternary Reaches for Secondary Catchments in South Africa. Compiled by RQIS-RDM: <https://www.dwa.gov.za/iwqs/rhp/eco/peseismodel.aspx>

Kleynhans, C.J & Louw, M.D. 2007. Module A: EcoClassification and EcoStatus determination in River EcoClassification: Manual for EcoStatus Determination (version 2). Joint Water Research Commission and Department of Water Affairs and Forestry report. WRC Report No. TT 329/08. DOI: 10.13140/RG.2.1.1728.3286

## Recommended citation

```{r}
#| output: asis
#| label: lst-citation-code

library(nbaR) 
library(knitr)
library(rmarkdown)

# Code for fetching the yaml metadata
# Note that this only runs when the .qmd file is rendered, therefore the outputs of this code block will return no results if you try to run it within R - that does not mean it is not working

meta <- knitr::opts_knit$get("rmarkdown.pandoc.to")  # forces knitr to load metadata
meta <- rmarkdown::metadata  # full YAML is now in `meta`

nba_citation(meta)
```



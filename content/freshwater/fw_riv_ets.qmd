---
# indentations are critical in YAML headers, be careful when editing this section

title: "River ecosystem threat status" # Compulsory
subtitle: "Freshwater (inland aquatic) realm" # Optional: delete if you are not using a subtitle

title-block-banner: "#4097C2" #Background colour of the title block: Apply component colours where necessary - find hex codes in _brand.yml
title-block-banner-color: white # Header text colour: DO NOT CHANGE

# List authors here in the order you want them displayed in the title block
# See examples in README
author:
  # Copy this block and add details for each author of your page. Make sure you maintain indentations exactly as they are here
  - name:
      given: Nancy 
      family: Job 
    orcid: 0000-0002-4929-7592 
    affiliations:
      - ref: sanbi
      # If an author has more than one affiliation, add more - ref: lines here
  - name:
      given: Andrew 
      family: Skowno
    affiliations:
      - ref: sanbi 
      - ref: uct
  - name:
      given: Jock 
      family: Currie 
    orcid: 0000-0002-7226-2988 
    affiliations:
      - ref: sanbi 
      
affiliations:
# List affiliations here and number them in the order that they are associated with the list of authors above. If multiple authors have the same affiliation, only list the affiliation once here.
# Write out institutional names in full
# See README for common examples - they can be copied and pasted here
# Make sure you maintain indentations exactly as they are here
  - id: sanbi 
    number: 1 
    name: South African National Biodiversity Institute
  - id: uct 
    number: 2 
    name: University of Cape Town

# This date determines the PUBLISHED date in the title block
date: last-modified

# Remember to rename the default .bib file and change the name here
bibliography: fw-references.bib

# This section sets up the page citation format. DO NOT EDIT
citation:
  type: webpage
  container-title: National Biodiversity Assessment 2025
  publisher: South African National Biodiversity Institute
  url: http://nba.sanbi.org.za/
# Do not edit or change any of the following entries
appendix-cite-as: false
google-scholar: true
---

*Rivers are among the most threatened ecosystems in South Africa, with over 65% of river types categorised as Threatened. This places the vital ecosystem services they provide and the incredible biodiversity they support at great risk.*

![Sandy banks and riparian forest along the Luvuvhu river within Kruger National Park. (© Nancy Job)](imgs/kruger.png)

------------------------------------------------------------------------

::::: columns
::: {.column width="50%"}
<center>

| [65%]{.inline-style-well-protected}
| of river length
| Threatened

</center>
:::

::: {.column width="50%"}
<center>

| [65%]{.inline-style-not-protected}
| of 222 river ecosystem types
| Threatened

</center>
:::
:::::

:::: columns
::: {.column width="50%"}
:::
::::

------------------------------------------------------------------------

Of South Africa’s 222 river ecosystem types, 22% (49) are Critically Endangered, 19% (44) are Endangered, 23% (52) are Vulnerable, and 34% (77) are of Least Concern. In terms of total river length, 2% is Critically Endangered, 6% Endangered, 56% Vulnerable, and 34% is of Least Concern.

::: panel-tabset
## Map

![Ecosystem threat status for river ecosystem types. The inset graph shows the number of ecosystem types per threat status category.](imgs/riv_ets_map.png){#fig-ets_riv_map}  

## Data

```{r}
#| label: tbl-ets
#| tbl-cap: "Ecosystem threat status of river ecosystem types."

# library(here)
library(stringr)
library(reactable)
library(dplyr)

# load data
ets <- read.csv(file=list.files(pattern = "^river_metrics_2.csv$", recursive = TRUE, full.names = TRUE), # ^riv_metrics_type.csv$
                    stringsAsFactors = FALSE, check.names = FALSE) %>% 
  select(type, zone, threat_status) %>% 
  ## take out the NA zones
  filter(!is.na(zone)) %>% 
  rename("River type" = type,
         Zone = zone,
         "Ecosystem threat status" = threat_status)
  # select(RIVTYPE, zone, protection_level) %>% # , RLE24, extent, RLE_EPL24) #
  # mutate(EPL24_all = str_replace_all(EPL24_all, "WP","Well Protected"),
  #        EPL24_all = str_replace_all(EPL24_all, "MP","Moderately Protected"),
  #        EPL24_all = str_replace_all(EPL24_all, "PP","Poorly Protected"),
  #        EPL24_all = str_replace_all(EPL24_all, "NP","Not Protected" )) %>% 
  # rename("River type" = RIVTYPE,
  #        Zone = zone,
  #        "Ecosystem Protection Level" = EPL24_all)

# create the table
reactable(
  ets,
  filterable = TRUE,
  searchable = FALSE,
  pagination = FALSE,
  height = 480,
  defaultColDef = colDef(
    headerStyle = list(background = "#4097C2", color = "white", fontWeight = "bold")
  ),
  theme = reactableTheme(
    inputStyle = list(
      color = "black", # create black searching text in the filter box, otherwise one doesn't see it!
      backgroundColor = "white",
      border = "1px solid #ccc"
    )),
  style = list(fontSize = "12px"))

```

:::

Ecosystem threat status varies across geomorphological zones with 67% of lowland river types being Critically Endangered compared to only 25% of mountain stream types.

:::: panel-tabset
## Figure

<!-- it is important to use second-level headings in panel tabsets, i.e. two hashes -->

```{r}
#| label: fig-river_ets_bargraph
#| fig-cap: "River ecosystem threat status within each geomorphological zone (slope category). (a) The percentage of ecosystem types per category (labelled with the number per type); (b) the percentage of river length (km) within each threat category, providing an indication of the relative extent of each category." 

library(tidyverse)
library(stringr)
library(nbaR)

# load data
riv_ets_tbl <- read.csv(file=list.files(pattern = "^river_metrics_2.csv$", recursive = TRUE, full.names = TRUE), # ^riv_metrics_type.csv$
                    stringsAsFactors = FALSE, check.names = FALSE) %>% 
  select(type, zone, threat_status, leng) %>% 
  ## take out the NA zones
  filter(!is.na(zone)) %>% 
  group_by(zone, threat_status) %>%
  summarise(count = n(),
            extent = sum(leng)) # %>%
  
# count table
count <- riv_ets_tbl %>%
  pivot_wider(
    id_cols = zone, # zone
    names_from = threat_status, # EPL24_all
    values_from = count) %>%
  mutate(across(where(is.numeric), ~replace_na(.x,0))) %>% 
  ungroup() %>% 
  select(zone, 'Critically Endangered', 'Endangered', 'Vulnerable', 'Least Concern') # %>% # reorder the columns
  # rowwise() %>% 
  # mutate(Total = sum(as.numeric(c_across(contains("Protected"))), na.rm = TRUE)) %>% 
  # ungroup()
# count

# ## add a totals row:
# count <- count %>%
#   bind_rows(
#     count %>%
#       summarise(across(where(is.numeric), ~ sum(.x, na.rm = TRUE))) %>%
#       mutate(zone = "Total count") %>%
#       select(zone, everything())
#   )
# count

# extent table
extent <- riv_ets_tbl %>%
  ## WARNING: DIVIDING BY 1000 TO TRANSFORM TO KM, ASSUMING THESE ARE IN M
  mutate(extent = extent/1000) %>% 
  pivot_wider(
    id_cols = zone, # zone
    names_from = threat_status, # EPL24_all
    values_from = extent) %>%
  mutate(across(where(is.numeric), ~replace_na(.x,0))) %>% 
  ungroup() %>% 
  select(zone, 'Critically Endangered', 'Endangered', 'Vulnerable', 'Least Concern') # %>% # reorder the columns
  # rowwise() %>% 
  # mutate(Total = sum(as.numeric(c_across(contains("Protected"))), na.rm = TRUE)) %>% 
  # ungroup()
# extent

# # add a totals row:
# extent <- extent %>%
#   bind_rows(
#     extent %>%
#       summarise(across(where(is.numeric), ~ sum(.x, na.rm = TRUE))) %>%
#       mutate(zone = "Total extent") %>%
#       select(zone, everything())
#   )
# extent

# combine count and extent in a single table
ets_combined <- count %>%
  mutate(metric = "count") %>%
  bind_rows(extent %>%
              mutate(metric = "extent")) %>%
  mutate(zone = factor(zone, levels = c("Mountain stream", "Upper foothill", "Lower foothill", "Lowland river")))
# ets_combined
    
## save the data to downloadable csv for the link, before arranging by zone for the plot
write.csv(ets_combined, file = "outputs/rivers_ETS.csv", row.names = FALSE)

# create ETS plot
ets_combined_plot <- ets_combined %>% 
    arrange(desc(zone)) %>% # zone 
  nba_plot_comb(
    zone,
    METRIC_COL = metric,
    METRICS = c("count", "extent"),
    2:5,
    CHRT = "bar",
    NUM = FALSE,
    LAB = "Percentage of ecosystem",
    SAVE = NULL) 

ets_combined_plot


```

## Data

<!--# If the table is long use the div to give it a vertical scroll bar. Otherwise the div can be excluded. -->

::: {#table .table style="height:500px;overflow-y: auto"}
```{r}
#| label:  tbl-river_ets
#| tbl-cap: Threat status of river ecosystem types summarised by geomorphological zone. Note that extent figures represent river length (km) and have been rounded. 
#| classes: plain

library(dplyr)
library(nbaR)
library(gt)

## create the table
## create the table

tbl <- ets_combined %>% 
  mutate(metric = str_replace_all(metric, "extent", "Extent  (km)"),
         metric = str_replace_all(metric, "count", "Count")) %>% 
  arrange(zone) %>% 
  select(zone, metric, 'Critically Endangered', 'Endangered', 'Vulnerable', 'Least Concern') %>%
  mutate(across(where(is.numeric), round)) %>% 
  gt::gt(
    rowname_col = "metric",
    groupname_col = "zone",
    row_group_as_column = TRUE) %>% 
  fmt_number(
    columns = where(is.numeric),
    decimals = 0,
    sep_mark = "\u202F") %>% 
  fmt_markdown(columns = metric) %>%  # tells gt to render HTML/Markdown in that column
  nbaR::nba_tbl_theme(HEADER = "Freshwater") %>% 
  tab_style(
    style = cell_text(color = "white"),
    locations = cells_column_labels()
  )

tbl


```
:::

Download the data [here](outputs/rivers_ETS.csv).
::::

```{=html}
<!--::: {#box-1 .callout-note .freshwater title="Box 1. River ecosystem threat status across primary catchments." collapse="true"}
## **Box 1. River ecosystem threat status across primary Catchments and Water Management Areas**

Text
:::

::: {#box-2 .callout-note .freshwater title="Box 2. River ecosystem threat status across provinces." collapse="true"}
## **Box 2. River ecosystem threat status across the Provinces**

Text
:::

::: {#box-3 .callout-note .freshwater title="Box 3. River ecosystem threat status across national parks." collapse="true"}
## **Box 3. River ecosystem threat status across National Parks**

Ecosystem threat status is a headline indicator established to assess how close an ecosystem type is to collapsing (losing vital aspects of its structure, function, or composition). It serves as an indicator of the degree to which ecosystems are still intact. Read more about this indicator on the [About ecosystem threat status page.](../integrated-findings/chl_rle_explained.qmd)

***Heading 3*** xxxx.
::: -->
```

## Approach

Ecosystem threat status is a headline indicator established to assess how close an ecosystem type is to collapsing (losing vital aspects of its structure, function, or composition). It serves as an indicator of the degree to which ecosystems are still intact.

Key input layers include [river ecosystem types](fw_riv_type.qmd) and [river ecological condition](fw_riv_condition.qmd).

The assessment was conducted using the IUCN Red List of Ecosystems framework (version 2), which has been applied across all realms for the 2025 assessments. The framework uses the concept of ecosystem collapse as the equivalent endpoint to species extinction. It evaluates the status of each ecosystem type using a set of quantitative and qualitative criteria linked to the key aspects of ecosystem decline, namely, Criterion A: reduction in extent, Criterion B: restricted distribution, Criterion C: environmental degradation and Criterion D: biotic degradation. Read more about this indicator on the [ecosystem threat status](https://sanbi-nba.github.io/nba-website/site-preview/content/integrated-findings/chl_ets_explained.html) explainer page.

The IUCN RLE (version 2) approach was followed and the following criteria were assessed for river ecosystems:

-   **Criterion B1aiii** was applied using extent of occupancy calculations with ongoing decline defined as an increase in the extent of D,E and F condition river length from the previous PES assessment period.

-   **Criterion D2b** was applied using the rate of change in condition between 2018 and 2024, projected forward to 2068 (a 50 year period).

-   **Criterion D3** was applied to the Present Ecological State (PES) data such that Severity \>=90% was assigned to PES classes E-F; Severity \>=70% was assigned to PES classes D-F; Severity \>=50% was assigned to PES classes C-F.

Each river ecosystem type was assessed against these criteria and the **highest risk category** triggered by any single criterion was assigned as the overall ecosystem threat status for that type. Each of the 222 river ecosystem types was placed into one of four risk categories: **Critically Endangered**, **Endangered**, **Vulnerable**, or **Least concern**. Critically endangered, endangered, and vulnerable are collectively referred to as the threatened categories.

## Technical documentation

**Code repository**

<https://github.com/askowno/ETS_riv>

**Key publications**

Harris, L.R., Skowno, A.L., Holness, S.D., Sink, K.J., van Niekerk, L., van Deventer, H., Smith-Adao, L., Job, N., Khatieb, S., Monyeki, M. (in review). Indicators for tracking progress in effective, representative ecosystem protection.

## Recommended citation

```{r}
#| output: asis
#| label: lst-citation-code

library(nbaR) 
library(knitr)
library(rmarkdown)

# Code for fetching the yaml metadata
# Note that this only runs when the .qmd file is rendered, therefore the outputs of this code block will return no results if you try to run it within R - that does not mean it is not working

meta <- knitr::opts_knit$get("rmarkdown.pandoc.to")  # forces knitr to load metadata
meta <- rmarkdown::metadata  # full YAML is now in `meta`

nba_citation(meta)
```

## References

::: {#refs}
:::

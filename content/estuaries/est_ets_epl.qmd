---
# indentations are critical in YAML headers, be careful when editing this section

title: "Integration of Ecosystem Threat Status and Protection Level" 
subtitle: "Estuarine Realm" 

title-block-banner: "##028A85" #Background colour of the title block: Apply component colours where necessary - find hex codes in _brand.yml
title-block-banner-color: white # Header text colour: DO NOT CHANGE

author:
  - name:
      given: Lara
      family: van Niekerk
    orcid: 0000-0001-5761-1337 
    affiliations:
      - ref: csir1
      - ref: nmu1
  - name:
      given: Andrew L.
      family: Skowno 
    orcid: 0000-0000-0000-0000 
    affiliations:
      - ref: sanbi1 
  - name:
      given: Kerry 
      family: Sink 
    orcid: 0000-0001-5051-573X 
    affiliations:
      - ref: sanbi1 
      - ref: nmu1
   - name:
      given: Linda R.
      family: Harris 
    orcid: 0000-0000-0000-0000  
    affiliations:
      - ref: nmu1     

affiliations:
  - id: csir1
    number: 1
    name: Council for Scientific and Industrial Research (CSIR), Stellenbosch,South Africa   
  - id: nmu1
    number: 2
    name: Institute for Coastal and Marine Research (CMR), Nelson Mandela University,Gqeberha, South Africa 
  - id: sanbi1
    number: 3
    name: South African National Biodiversity Institute (SANBI)

# This date determines the PUBLISHED date in the title block
date: last-modified

# Remember to rename the default .bib file and change the name here
bibliography: est_references.bib

# This section sets up the page citation format. DO NOT EDIT
citation:
  type: webpage
  container-title: National Biodiversity Assessment 2025
  publisher: South African National Biodiversity Institute
  url: http://nba.sanbi.org.za/
# Do not edit or change any of the following entries
appendix-cite-as: false
google-scholar: true
---

## Threatened and under-protected ecosystem types

There are 27 marine ecosystem types that are both highly threatened and under-protected. The highest priorities are the Critically Endangered Orange Cone Inner Shelf Mud Reef Mosaic which is Not Protected and five ecosystem types that are both Endangered and Not Protected. This includes the Orange Cone Muddy Mid Shelf, Cape Lower Canyon, St Helena Bay, Cape Sheltered Rocky Shore and the KZN Bight Mid Shelf Reef Complex. Three ecosystem types are Critically Endangered and Poorly Protected; the Agulhas Muddy Mid Shelf, Browns Bank Rocky Shelf Edge and Cape Bay. Endangered and poorly protected ecosystem types include some several shore types in the Namaqua, Cape and Agulhas Regions, False and Walker Bay, Western Agulhas Bays, two ecosystem types on the southern KZN shelf and four ecosystem types in the KZN Bight.

```{r}
#| label: tbl-ets_epl
#| echo: false
#| tbl-cap: Table summarising the distribution of protection levels across different threat status categories for marine ecosystem types.

library(dplyr)
library(nbaR)
# library(sf)


# mem <-  st_read(
#     dir("data",
#         "marine_ecosystems.gpkg",
#         full.names = T,
#         recursive = T)[1],
#   quiet = TRUE) %>% 
#   st_drop_geometry() %>%  
#   select(c(ecosystem_type, protection_level, threat_status))


thr_pro <- read.csv(file=list.files(path = paste0(here::here(), "/quarto/data"), pattern = "^epl_ets_ecotypes.csv$", recursive = TRUE, full.names = TRUE), 
                    stringsAsFactors = FALSE, check.names = FALSE) %>% # mem %>%
  # because we had renamed them, need to name them back without spaces as the nba_tbl_comb() wasn't handling the spaces even with inverted commas
  rename(ecosystem_type = "Ecosystem type", protection_level = "Protection level", threat_status = "Threat status") %>% 
  select(ecosystem_type, threat_status, protection_level) %>%
  nbaR::nba_tbl_comb(GROUP = ecosystem_type,
                     THR =threat_status,
                     PRO = protection_level,
                     FILE ="csv")

thr_pro

```

Threatened and under-protected ecosystem types are candidates for improved protection through MPA expansion or other spatial management measures that could be recognised as Other Effective Conservation Measures (OECMs). In addition to expansion of protection of these ecosystem types, it is important to improve ecosystem condition through flow restoration, reduced fishing pressure and improved ecosystem management. Improved bycatch management and diversified measures to protect bathers from sharks using non-lethal measures could help improve ecosystem condition in KwaZulu-Natal.

There is good progress in evaluating the ecological, socio-economic and governance effectiveness of South Africaâ€™s MPAs (Kirkman et al. 2021, 2023, Mann Lang et al. 2021, Sink et al. 2023), which reveal gaps in participation, cultural heritage protection and governance limiting progress in protection. Sink et al. (2023) share lessons from the 2019 Marine Protected Area expansion which are relevant to future expansion efforts.

```{r}
#| label: fig-rle_map
#| fig-cap: Threatened and under-protected benthopelagic and deepsea benthic ecosystem types.
#| echo: false
#| message: false
#| warning: false
#| out-width: 100%

#devtools::install_github("SANBI-NBA/nbaR")
library(tidyverse)
library(nbaR)
library(sf)


# #marine linewidth
# m_lwd = 0.001
# 
# 
# dat <-  st_read(
#     dir("data",
#         "marine_results_for_integration.gpkg",
#         full.names = T,
#         recursive = T)[1],
#   quiet = TRUE)
# 
# eez <- st_read(list.files(path="data", 
#                              pattern="^eez_MEM2018.gpkg$", 
#                              recursive = T, 
#                              full.names = T)[1],
#   quiet = TRUE)
# 
# marine_benth <- dat %>%
#   group_by(type_name,zone, RLE_EPL) %>% #
#   summarise(geometry = st_union(geom)) %>%
#   st_cast(to = "MULTIPOLYGON") %>%
#   filter(zone !="Pelagic ocean waters",
#          RLE_EPL %in% c("CR_NP", "CR_PP", "EN_NP", "EN_PP"))%>% 
#   st_transform(crs = 4326)
#                              
# 
# 
# RLEmap <- nbaR::nba_map(marine_benth,
#                            "vector",
#                            FILL = RLE_EPL, 
#                         LEGEND = T) +
#   geom_sf(data=eez, colour = "black", fill = NA, lwd = m_lwd) + #add ecosystem outlines for marine
#   #geom_sf(data=eez, colour = "black", fill = NA, lwd = t_lwd) + #add province outlines
#   theme(plot.margin=grid::unit(c(0,0,0,0), "pt")
#         # ,
#         # legend.key.size = ggplot2::unit(1,"line"),
#         #  legend.position = "inside",
#         #  legend.justification = c("right", "bottom"),
#         # legend.title = element_blank()
#         ) +  #remove white space around the plot
#   coord_sf(expand = FALSE)    # <-- prevents padding around data
# # theme_void()
# 
# #ggsave(plot = RLEmap, filename = "imgs/ets_benth.jpg")
# 
# ## add the donut plot
# 
# rle_donut <- marine_benth %>% 
#   st_drop_geometry() %>% 
#   ungroup() %>% 
#   count(RLE_EPL) %>% 
#   tidyr::pivot_wider(names_from = RLE_EPL, values_from = n) %>% 
#   mutate(RLE = "RLE") %>% 
#   select(RLE, CR_NP,CR_PP, EN_NP, EN_PP) %>% 
#   nbaR::nba_plot(GROUPS = RLE, 
#                  COLS = 2:5, 
#                  CHRT = "donut",
#                  NUM = TRUE, 
#                  LAB = "", 
#                  GRP = F) +
#   theme(legend.position = "none") 
# 
# final_plot <- RLEmap + 
#   annotation_custom(ggplotGrob(rle_donut),
#                     xmin=18, ymin=-33, xmax=29, ymax=-27)
# 
# print(final_plot)



knitr::include_graphics("imgs/rle_unluckies.png")


```

## Technical documentation

<!--# This section is compulsory for all scientific content, but what you include here is flexible based on what you have available for your indicators -->

<!--# the below examples/recommendations can be modified, e.g. you could do a technical report PDF, as long as it is made available on a public repository (figshare?) and can be linked to in this document -->

<!--# avoid linking to Google Drive or other personal drives that may not be permanent. -->

<!--# Always use DOI to link to published papers - never use the journal's website -->

### GitLab repositories

-   **Protection level assessment**: [gitlab.com/nba_2025/ecosystem_assessment/protection_level](https://gitlab.com/nba_2025/ecosystem_assessment/protection_level)

-   **Threat status assessment**: [gitlab.com/nba_2025/ecosystem_assessment/threat_status](https://gitlab.com/nba_2025/ecosystem_assessment/threat_status)

### Key Publications

## Recommended citation

```{r}
#| output: asis
#| label: lst-citation-code

library(nbaR) 
library(knitr)
library(rmarkdown)

# Code for fetching the yaml metadata
# Note that this only runs when the .qmd file is rendered, therefore the outputs of this code block will return no results if you try to run it within R - that does not mean it is not working

meta <- knitr::opts_knit$get("rmarkdown.pandoc.to")  # forces knitr to load metadata
meta <- rmarkdown::metadata  # full YAML is now in `meta`

nba_citation(meta)

```

::: {#refs}
:::
